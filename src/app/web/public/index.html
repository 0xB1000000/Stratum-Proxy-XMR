<script src="lib/jquery/jquery-3.2.1.min.js"></script>

<script src="lib/popper/1.12.3/umd/popper.min.js"></script>

<link  href="lib/bootstrap-4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet" >
<script src="lib/bootstrap-4.0.0-beta.2/js/bootstrap.min.js"></script>

<link rel="stylesheet" type="text/css" href="lib/datatable/css/style.css"/>
<script type="text/javascript" src="lib/datatable/js/datatables.min.js"></script>

<script type="text/javascript" src="lib/noty/noty.min.js" ></script>
<link rel="stylesheet" type="text/css" href="lib/noty/noty.css">

<script type="text/javascript" src="lib/socket.io/socket.io.js" ></script>
 
<body>


	<!--
	<nav class="navbar fixed-top navbar-dark bg-dark">
		<a class="navbar-brand" href="#">Jerry STRATUM~PROXY~XMR</a>
	</nav>
	-->

	
	<header class="navbar">
		<nav class="nav nav-tabs fixed-top bg-white" id="myTab" role="tablist">
			<a class="nav-item nav-link active" id="nav-1-tab" data-toggle="tab" href="#nav-target-1" role="tab" aria-controls="nav-target-1" aria-selected="true">Workers</a>
			<a class="nav-item nav-link"        id="nav-2-tab" data-toggle="tab" href="#nav-target-2" role="tab" aria-controls="nav-target-2" aria-selected="false">Done hashes</a>
			<a class="nav-item nav-link"        id="nav-4-tab" data-toggle="tab" href="#nav-target-4" role="tab" aria-controls="nav-target-4" aria-selected="false">Jobs</a>
			<a class="nav-item nav-link"        id="nav-5-tab" data-toggle="tab" href="#nav-target-5" role="tab" aria-controls="nav-target-5" aria-selected="false">Pool</a>
			<a class="nav-item nav-link"        id="nav-3-tab" data-toggle="tab" href="#nav-target-3" role="tab" aria-controls="nav-target-3" aria-selected="false">Console</a>
			<!-- <a class="nav-item nav-link flex-row ml-md-auto d-none d-md-flex global-hash-rate-wrap"  >Hash rate[5s/60s/5m/15m/30m/60m]: <div class="global-hash-rate"></div></a> -->
		</nav>
		
		<div class="fixed-top" style="" >
			<div style="width: auto; right: 0px; position: absolute; top: -5px; height: 46px; overflow-y: hidden;">
			
			<table class="display table-sm tb-hash-rate table-light table-dark ">
				<thead>
					<tr>
						<th>15s</th>
						<th>1m</th>
						<th>5m</th>
						<th>15m</th>
						<th>30m</th>
						<th>60m</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="t-15s" >n/a</td>
						<td class="t-1m" >n/a</td>
						<td class="t-5m" >n/a</td>
						<td class="t-15m" >n/a</td>
						<td class="t-30m" >n/a</td>
						<td class="t-60m" >n/a</td>
					</tr>
				</tbody>
			</table>
			</div>
		</div>
	</header>


	
	

	<div class="tab-content" id="nav-tabContent">	
		<div class="tab-pane fade show active width: 100%;" id="nav-target-1" role="tabpanel" aria-labelledby="nav-1-tab">
	  
			<table class="display table table-hover table-dark" id="worker-list" cellspacing="0"  width="100%" >
				<thead>
					<tr>
						<th>#</th>
						<th>Ip</th>
						<th>Port</th>
						<th>Agent</th>
						<th>Wallet</th>
						<th>Password</th>
						<th>Hashrate [15s/60s/5m/15m/30m/60m]</th>
						<th>Done hashes count</th>
						<th>Time in work</th>
						<th>Connection time</th>
						<th>Disconnection time</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
		
		</div>
		<div class="tab-pane fade" id="nav-target-2" role="tabpanel" aria-labelledby="nav-2-tab">
	  
			<table class="display table table-hover table-dark" id="done-hash-list" cellspacing="0"  width="100%" >
				<thead>
				<tr>
				  <th>#</th>
				  <th>Worker info</th>
				  <th>Job id</th>
				  <th>Job nonce</th>
				  <th>Difficulty</th>
				  <th>Time</th>
				  <th>Time of work</th>
				  <th>Status</th>
				</tr>
				</thead>
				<tbody></tbody>  
			</table>

		</div>

		<div class="tab-pane fade" id="nav-target-4" role="tabpanel" aria-labelledby="nav-4-tab">
		
			<table class="display table table-hover table-dark" id="job-list" cellspacing="0"  width="100%" >
				<thead>
					<tr>
					  <th style="" >#</th>
					  <th style="" >Job id</th>
					  <th>Job start nonce</th>
					  <th>Difficulty</th>
					  <th>Time</th>
					</tr>
				</thead>
				<tbody></tbody>  
			</table>
			
		</div>
		
		<div class="tab-pane fade" id="nav-target-5" role="tabpanel" aria-labelledby="nav-5-tab">
		
			<table class="display table table-hover table-dark" id="pool-list" cellspacing="0"  width="100%" >
				<thead>
					<tr>
					  <th style="" >#</th>
					  <th style="" >Ip</th>
					  <th>Port</th>
					  <th>Job count</th>
					  <th>Accepted result</th>
					  <th>Rejected result</th>
					  <th>Time in work</th>
					  <th>Connection time</th>
					  <th>Disconnection time</th>
					</tr>
				</thead>
				<tbody></tbody>  
			</table>
			
		</div>

		
		<div class="tab-pane fade" id="nav-target-3" role="tabpanel" aria-labelledby="nav-3-tab">
		
			<table class="display table table-hover table-dark" id="console-line-list" cellspacing="0"  width="100%" >
				<thead>
				<tr>
				  <th style="" >#</th>
				  <th style="" >Time</th>
				  <th>Log</th>
				</tr>
				</thead>
				<tbody></tbody>  
			</table>
			
		</div>
	</div>
</div>


	
<div class="modal" tabindex="-1" role="dialog" id="modal-restart">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Restart...</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>The proxy server is rebooted. Restart.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-restart"  >Restart</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>	
	
<style>
body {
	margin-top: 56px;
}

.tb-hash-rate {
	font-size: 12px;
}

#console-line-list {
	font-size: 12px;
}
#console-line-list tbody * {
	padding: 5px;
}

.dataTables_scrollHead * {
	font-size: 12px;
}


#done-hash-list, #worker-list, #job-list, #pool-list {
	font-size: 12px;
}

.popover * {
	font-size: 12px;
}

.global-hash-rate-wrap {
	font-size: 12px;
}
.global-hash-rate .hash_rate_table {
	width: 300px;
}
.global-hash-rate span {
	margin-left: 5px;
	font-size: 12px;
}
.hash_rate_table {
	margin: 0px;
	padding: 0px;
	width: 250px;
}
.hash_rate_table span {
	display: block;
	float: left;	
	width: 40px;
}

#show-gb-hash-rate {
	right: 0px;
}
#show-gb-hash-rate * {
	font-size: 12px;
}

</style>
 
<script src="app/message.js"></script>
 
<script>

function NetInfo(ip, port) {
	this.ip = ip;
	this.port = port;
}
function WorkerInfo(
	net, 
	id,
	agent, 
	wallet, 
	password, 
	result_job_count,
	connection_time, 
	disconnection_time
) {
	this.net = net;
	this.agent = agent;
	this.wallet = wallet;
	this.password = password;
	this.result_job_count = result_job_count;
	this.connection_time = connection_time;
	this.disconnection_time = disconnection_time;
}

(function($) {
	function escapeHtml(html) {
		var span = document.createElement('span');
		
		escapeHtml = function(html) {
			span.innerText = html;
			return span.innerHTML;
		}
		
		return escapeHtml(html);
	}
	
	function Logger($console) {
		this.maxId = -1;
		this.$console = $console;
		this.dataTable = $console.DataTable();
		
		var colors = Object.create(null);
			colors[Logger.LOG_COLOR_RESET   ] = '<span style="color: #ffffff" >';
			colors[Logger.LOG_COLOR_SR      ] = '<span style="color: #868e96" >';
			colors[Logger.LOG_COLOR_RED     ] = '<span style="color: #dc3545" >';
			colors[Logger.LOG_COLOR_GREEN   ] = '<span style="color: #28a745" >';
			colors[Logger.LOG_COLOR_YELLOW  ] = '<span style="color: #ffc107" >';
			colors[Logger.LOG_COLOR_BLUE    ] = '<span style="color: #007bff" >';
			colors[Logger.LOG_COLOR_WHITE   ] = '<span style="color: #ffffff" >';
			colors[Logger.LOG_COLOR_DEVMODE ] = '<span style="color: #868e96" >';
			colors[Logger.LOG_COLOR_MAGENTA ] = '<span style="color: #d608ea" >';
			colors[Logger.LOG_COLOR_CYAN    ] = '<span style="color: #17a2b8" >';

			colors[Logger.LOG_COLOR_MAGENTA_LIGHT] = '<span style="color: #d608ea; text-shadow: -3px -2px 5px;" >';
			colors[Logger.LOG_COLOR_GREEN_LIGHT  ] = '<span style="color: #28a745; text-shadow: -3px -2px 5px;" >';
		this.colors = colors;
		
		
		this.elemSpanTmp = document.createElement('span');
		this.escapeHtml = function(html) {
			this.elemSpanTmp.innerText = html;
			return this.elemSpanTmp.innerHTML;
		}
	}
	Logger.prototype.add = function(time, log) {
		this.dataTable.row.add([time, log]).draw();
	}
	Logger.prototype.addList = function(list) {
		for(var i = 0; i < list.length; i++) {
			list[i][0] = this.escapeHtml(list[i][0]);
			list[i][1] = this.escapeHtml(list[i][1]);
			list[i][2] = this.escapeHtml(list[i][2]);

			list[i][2] = this.prepareMan(list[i][2]);
		}

		this.dataTable.rows.add(list).draw();
	}
	Logger.prototype.listProcess = function(logs) {
		logs.sort(function(l, r) {
			return l[0] - r[0];
		});
		if ( !logs.length ) {
			return;
		}

		let addedList = [];
		for(let i = 0; i < logs.length; i++) {
			let log = logs[i];
			if ( log[0] <= this.maxId ) {
				continue;
			}
			
			this.maxId = log[0];
			addedList.push([log[0], log[1], log[2]]);
		}
	
		if ( addedList.length ) {
			this.addList(addedList);
		}
	}
	Logger.prototype.prepareMan = function(text) {
		var self = this;
	
		var count = 0;
		text = text.replace(/\033.*?m/g, (m) => {
			var cl = self.colors[m];
			if ( cl ) {
				count++;
				return cl;
			}
			
			return "";
		});
		
		while(count--) {
			text += '</span>';
		}
		
		return text;
	}
	Logger.LOG_COLOR_RESET   = "\033[0m";
	Logger.LOG_COLOR_SR	     = "\033[1;30m";
	Logger.LOG_COLOR_RED     = "\033[1;31m";
	Logger.LOG_COLOR_GREEN   = "\033[1;32m";
	Logger.LOG_COLOR_YELLOW  = "\033[1;33m";
	Logger.LOG_COLOR_BLUE    = "\033[1;34m";
	Logger.LOG_COLOR_WHITE   = "\033[1;37m";
	Logger.LOG_COLOR_DEVMODE = "\033[1;35m";
	Logger.LOG_COLOR_MAGENTA = "\033[1;35m";
	Logger.LOG_COLOR_CYAN    = "\033[1;36m";
	Logger.LOG_COLOR_MAGENTA_LIGHT = "\033[0;35m";
	Logger.LOG_COLOR_GREEN_LIGHT   = "\033[0;32m";
	
	
	

	function stringNormalizeLen(s, maxLen) {
		if ( s.length <= maxLen ) {
			return s;
		}
		
		return s.slice(0, (maxLen>>1)) + "..." + s.slice(-(maxLen>>1));
	}
	function deltaSecToString(sec) {
		sec = Math.round(sec);
		
		var s = "";
		
		var _h = Math.floor(sec/3600); sec %= 3600;
		var _m = Math.floor(sec/60);   sec %= 60;
		var _s = sec;
	
		if ( _h !== 0 ) s += _h + "h ";
		if ( _m !== 0 ) s += _m + "m ";
		                s += _s + "s ";
		
		return s;
	}
	function deltaMiliSecToString(sec) {
		return deltaSecToString(sec*1e-3);
	}
	function currTimeMiliSec() {
		return (new Date()).getTime();
	}
	function currTimeSec() {
		return currTimeMiliSec() * 1e-3;
	}
	function miliSecToString(msec) {
		var d = new Date(msec);
		return `${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;
	}
	function hrp(hr) {
		return (hr === null || hr === undefined) ?
			"n/a" : parseFloat(hr).toFixed(2);
	}
		
	function Workers($workers) {
		this.$workers = $workers;
		this.dataTable = $workers.DataTable();
		
		this.workerList = Object.create(null);
	}
	Workers.prototype.listProcess = function(workerList) {
		for(var i = 0; i < workerList.length; i++) {
			var worker = workerList[i];

			if ( !this.workerList[worker.id] ) {
				var index = this.dataTable.row.add(['','','','','', '','','','','','',])[0][0];
				this.workerList[worker.id] = { dtRowIndex: index, };
			}
			
			this.workerList[worker.id].worker = worker;
			
			this.syncWorker(worker.id);
		}
		
		this.dataTable.draw();
	}
	Workers.prototype.syncWorker = function(id) {
		var workerWrap = this.workerList[id];
		var worker = workerWrap.worker;
		
		var isUpdateTime = worker.alive ? "update_time" : "";
		
		var disconnectTimeSpan = worker.disconnection_time === null ? 
			'<span style="color: #28a745; text-shadow: -3px -2px 5px;" >Alive</span>' :
			'<span style="color: #dc3545; text-shadow: -3px -2px 5px;" >'+miliSecToString(worker.disconnection_time)+'</span>';
			
		worker._start_time = currTimeMiliSec() - worker.time_in_work;
		

		
		var hash_rate_table = `
				<div class="hash_rate_table" >
					<span>${hrp(worker.hash_rate_list.sec15)}</span>
					<span>${hrp(worker.hash_rate_list.sec60)}</span>
					<span>${hrp(worker.hash_rate_list.min5)}</span>
					<span>${hrp(worker.hash_rate_list.min15)}</span>
					<span>${hrp(worker.hash_rate_list.min30)}</span>
					<span>${hrp(worker.hash_rate_list.min60)}</span>
				</div>
		`;
		
		this.dataTable.row(workerWrap.dtRowIndex).data([
			'<span worker_id="'+ parseInt(worker.id)+'" >'+parseInt(worker.id)+'</span>',
			escapeHtml(worker.ip),
			escapeHtml(worker.port),
			escapeHtml(stringNormalizeLen(worker.agent, 32)),
			escapeHtml(stringNormalizeLen(worker.wallet_address, 32)),
			escapeHtml(stringNormalizeLen(worker.pool_password, 32)),
			hash_rate_table,
			parseInt(worker.doneHashesCount),
			'<span '+isUpdateTime+' start_time="'+ worker._start_time +'"  >' 
				+ deltaMiliSecToString(currTimeMiliSec() - worker._start_time) + 
			'</span>',
			miliSecToString(worker.connection_time),
			
			disconnectTimeSpan,
		]);
		
		if ( !worker.alive ) {
			$(this.dataTable.row(workerWrap.dtRowIndex).node()).addClass("table-secondary").css({'color': '#121212'});
		}
	}
	Workers.prototype.updateTimeInWork = function() {
	
		$('[update_time]').each(function(i, elem) {
			elem = $(elem);
			var startTime = parseInt(elem.attr('start_time'));
			if ( startTime ) {
				elem.text( deltaMiliSecToString( currTimeMiliSec() - startTime ) );
			}
		});
		
		var self = this;
		setTimeout(function() {
			self.updateTimeInWork();
		}, 1e3);
	}

	$(document).on('click', '[data-toggle="popover"]', function(e) {
		var c = "-popover-wrap-set";
		var $e = $(e.target);
		if ( !$e.hasClass(c) ) {
			$e.addClass(c);
			$e.popover('show');
		}
	});


	function ResultJobList($resultJobList) {
		this.$resultJobList = $resultJobList;
		this.dataTable = this.$resultJobList.DataTable();
	}
	ResultJobList.prototype.addItem = function(item) {
		var id = item[0];
		var params = item[1];

		
		var workerInfo = "";
		
		workerInfo = `
			<a href="#" tabindex="0"  
				style="color: #fff; text-shadow: -3px -2px 5px; text-decoration: none;" 
				data-toggle="popover" 
				data-trigger="focus"
				title="Worker info" 
				data-content=""
				data-template='
				<div class="popover" role="tooltip" style="max-width: none;">
					<div class="arrow"></div>
					<h3 class="popover-header"></h3>
					<div class="popover-body"></div>
					<div style="padding: 10px">
						<table class="table table-hover">
							<tr><td>Worker id</td><td>${escapeHtml(params.worker_info.id)}</td></tr>
							<tr><td>Ip:Port</td><td>${escapeHtml(params.worker_info.ip + ":" + params.worker_info.port)}</td></tr>
							<tr><td>Agent</td><td>${escapeHtml(params.worker_info.agent)}</td></tr>
							<tr><td>Wallet</td><td>${escapeHtml(params.worker_info.wallet_address)}</td></tr>
							<tr><td>Password</td><td>${escapeHtml(params.worker_info.pool_password)}</td></tr>
							<tr><td>Job id</td><td>${escapeHtml(params.worker_info.job_id)}</td></tr>
						</table>
					</div>
				</div>
				'
			>`+
			escapeHtml(
				'#' + (params.worker_info.id) + " | " +
				params.worker_info.ip + ":" + params.worker_info.port + " | " + 
				stringNormalizeLen(params.worker_info.agent, 16) + " | " + 
				stringNormalizeLen(params.worker_info.wallet_address, 16) + " | " +
				stringNormalizeLen(params.worker_info.pool_password, 16) 
			) +
			`</a>`;
		
		var isAcceptedMsg = params.is_accepted ? 
			'<span style="color: #28a745; text-shadow: -3px -2px 5px;">Accepted</span>' : 
			`
			<a href="#" tabindex="0"  
				style="color: #dc3545; text-shadow: -3px -2px 5px; text-decoration: none;" 
				data-toggle="popover" 
				data-trigger="focus"
				title="Pool send error" 
				data-content="${escapeHtml(params.error_message)}"
			>
				Rejected
			</a>`;

		this.dataTable.row.add([
			parseInt(id), 
			workerInfo, 
			escapeHtml(stringNormalizeLen(params.worker_info.job_id, 16, 16)), 
			escapeHtml(stringNormalizeLen(params.worker_info.job_nonce, 8, 8)), 
			parseFloat(params.difficulty).toFixed(2), 
			miliSecToString(params.endTime), 
			deltaMiliSecToString(params.timeOfWork), isAcceptedMsg
		]);
	}
	ResultJobList.prototype.listProcess = function(list) {
		for(var i = 0; i < list.length; i++) {
			this.addItem(list[i]);
		}
		
		this.dataTable.draw();
	}
	
	
	/*<script>*/
	function JobList($jobList) {
		this.$jobList = $jobList;
		this.dataTable = this.$jobList.DataTable();
	}
	JobList.prototype.addItem = function(item) {
		this.dataTable.row.add([
			parseInt(item.id),
			escapeHtml(stringNormalizeLen(item.job_id, 32)),
			escapeHtml(item.start_nonce),
			item.difficulty.toFixed(2),
			miliSecToString(item.start_time)
		]);
	}
	JobList.prototype.listProcess = function(list) {
		for(var i = 0; i < list.length; i++) {
			this.addItem(list[i]);
		}
		
		this.dataTable.draw();
	}

	
	function PoolList($poolList) {
		this.$poolList = $poolList;
		this.dataTable = this.$poolList.DataTable();
		
		
		this.poolList = Object.create(null);
	}
	PoolList.prototype.addItem = function(item) {
		if ( this.poolList[item.id] === undefined ) {
			this.poolList[item.id] = {
				dtRowIndex: this.dataTable.row.add([0,0,0,0,0, 0,0,0,0,]),
				poolInfo: item
			};
		}
		
		this.syncPool(item);
	}
	PoolList.prototype.syncPool = function(pool) {
		var poolWrap = this.poolList[pool.id];
		if ( !poolWrap ) {
			return;
		}
		
		
		
		var isUpdateTime = pool.alive ? "update_time" : "";
		
		pool._start_time = currTimeMiliSec() - pool.time_in_work;
		
		var disconnectTimeSpan = pool.disconnection_time === null ? 
			'<span style="color: #28a745; text-shadow: -3px -2px 5px;" >Alive</span>' :
			'<span style="color: #dc3545; text-shadow: -3px -2px 5px;" >'+miliSecToString(pool.disconnection_time)+'</span>';
			
		this.dataTable.row(poolWrap.dtRowIndex).data([
			parseInt(pool.id),
			escapeHtml(pool.host),
			escapeHtml(pool.port),
			parseInt(pool.job_count),
			parseInt(pool.accepted_result),
			parseInt(pool.rejected_result),
			
			'<span '+isUpdateTime+' start_time="'+ pool._start_time +'"  >' 
				+ deltaMiliSecToString(currTimeMiliSec() - pool._start_time) + 
			'</span>',	
		
			miliSecToString(pool.connection_time),
			disconnectTimeSpan
		]);
		
		if ( !pool.alive ) {
			$(this.dataTable.row(poolWrap.dtRowIndex).node()).addClass("table-secondary").css({'color': '#121212'});
		}
	}
	PoolList.prototype.listProcess = function(list) {
		for(var i = 0; i < list.length; i++) {
			this.addItem(list[i]);
		}
		
		this.dataTable.draw();
	}

	
	/*<script>*/

	$(function() {
		$('#worker-list').DataTable({
			scrollY: "calc(100% - 200px)",
			scrollCollapse: true, 
			orderMulti: true,
			"orderFixed": [ 10, 'desc' ]
		});
		$('#done-hash-list').DataTable({
			scrollY: "calc(100% - 200px)",
			scrollCollapse: true, 
			order: [[ 0, 'desc' ]],
		});
		$('#console-line-list').DataTable({
			scrollY: "calc(100% - 200px)",
			scrollCollapse: true, 
			order: [[ 0, 'desc' ]],
		});
		$('#job-list').DataTable({
			scrollY: "calc(100% - 200px)",
			scrollCollapse: true, 
			order: [[ 0, 'desc' ]],
		});
		$('#pool-list').DataTable({
			scrollY: "calc(100% - 200px)",
			scrollCollapse: true, 
			order: [[ 0, 'desc' ]],
		});

		var logger = new Logger( $('#console-line-list') );
		var workers = new Workers( $('#worker-list') );
		var resultJobList = new ResultJobList( $('#done-hash-list') );
		var jobList = new JobList( $('#job-list') );
		var poolList = new PoolList( $('#pool-list') );
		
		workers.updateTimeInWork();

		var gb_stat_id = null;
		
		var socket = io();
		
		

		socket.on('stat_id', function(id) {
			if ( gb_stat_id !== null ) {
				if ( gb_stat_id !== id ) {
					socket.close();
					$('#modal-restart').modal('show');
				}
				
			}
			gb_stat_id = id;
		});
		$(document).on('click', '.btn-restart', function() {
			location.reload();
		});
		
		socket.emit('logs');
		socket.on('log', function(logStringData) {
			var logList = (new Message()).parseMsgs(logStringData, "log");
			logger.listProcess(logList)
		});
		
		socket.emit('dead_worker');
		socket.on('dead_worker', function(workerData) {
			var deadWorkerList = (new Message()).parseMsgs(workerData, 'dead_worker');
			workers.listProcess(deadWorkerList);
		});
		socket.on('worker_list', function(workerList) {
			workers.listProcess(workerList);
		});
		
		socket.emit('result_job_info');
		socket.on('result_job_info', function(resJobInfo) {
			var resJobInfoList = (new Message()).parseMsgs(resJobInfo, 'result_job_info');
			resultJobList.listProcess(resJobInfoList);
		});
		
		socket.emit('jobs');
		socket.on('jobs', function(jobsData) {
			jobList.listProcess(
				(new Message()).parseMsgs(jobsData, 'jobs')
			);
		});
		
		socket.emit('dead_pools');
		socket.on('dead_pools', function(poolsData) {
			poolList.listProcess(
				(new Message()).parseMsgs(poolsData, 'dead_pools')
			);
		});
		socket.on('pools', function(pools) {
			poolList.listProcess(pools);
		});
		
		socket.on('noty', function(notyInfo) {
			var n = new Noty({
				type: notyInfo.type, 
				text: escapeHtml(notyInfo.text),
			});
			n.setTimeout(notyInfo.timeout | 1e3*2);
			n.show();
		});
	
	
		socket.on('global_hash_rate', function(hash_rate_list) {
			$('.t-15s').text(hrp(hash_rate_list.sec15));
			$('.t-1m').text(hrp(hash_rate_list.sec60));
			$('.t-5m').text(hrp(hash_rate_list.min5));
			$('.t-15m').text(hrp(hash_rate_list.min15));
			$('.t-30m').text(hrp(hash_rate_list.min30));
			$('.t-60m').text(hrp(hash_rate_list.min60));
			var hash_rate_table = `
					<div class="hash_rate_table" >
						<span>${hrp(hash_rate_list.sec15)}</span>
						<span>${hrp(hash_rate_list.sec60)}</span>
						<span>${hrp(hash_rate_list.min5)}</span>
						<span>${hrp(hash_rate_list.min15)}</span>
						<span>${hrp(hash_rate_list.min30)}</span>
						<span>${hrp(hash_rate_list.min60)}</span>
					</div>
			`;
			
			$('.global-hash-rate').html(hash_rate_table);
		});
		
		setInterval(() => $(window).trigger('resize'), 1e2);
	});

})(jQuery);

</script>

 

</body>
